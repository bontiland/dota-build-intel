<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>STRATZ Schema Explorer</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{background:#0a0c10;color:#e2e8f0;font-family:'Segoe UI',system-ui,sans-serif;padding:24px}
    h1{color:#f59e0b;margin-bottom:20px;font-size:20px;letter-spacing:2px}
    h2{color:#f59e0b;font-size:15px;margin:20px 0 10px;letter-spacing:1px}
    button{background:#f59e0b;color:#000;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-weight:700;font-size:14px;font-family:inherit;margin-right:10px;margin-bottom:10px}
    button:disabled{opacity:.5;cursor:not-allowed}
    button.sec{background:rgba(245,158,11,.15);color:#f59e0b;border:1px solid rgba(245,158,11,.3)}
    pre{background:#0d1017;border:1px solid rgba(255,255,255,.08);border-radius:8px;padding:14px;font-size:12px;overflow:auto;max-height:400px;color:#9ca3af;white-space:pre-wrap;word-break:break-all;margin-top:8px}
    .ok{color:#4ade80}
    .err{color:#f87171}
    .info{color:#60a5fa}
    .spin{display:inline-block;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .card{background:#0d1017;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:16px;margin-bottom:16px}
    input{background:rgba(255,255,255,.06);border:1px solid rgba(245,158,11,.25);border-radius:8px;padding:8px 12px;color:#e2e8f0;font-size:13px;font-family:inherit;width:100%;margin-bottom:8px;outline:none}
    textarea{background:#0d1017;border:1px solid rgba(245,158,11,.3);border-radius:8px;padding:12px;color:#e2e8f0;font-size:12px;font-family:monospace;width:100%;height:160px;outline:none;resize:vertical}
  </style>
</head>
<body>
<h1>‚óÜ STRATZ SCHEMA EXPLORER</h1>
<p style="color:#6b7280;font-size:13px;margin-bottom:20px">Herramienta de diagn√≥stico ‚Äî descubre qu√© queries acepta la API de STRATZ</p>

<div class="card">
  <h2>PASO 1 ‚Äî Verificar conexi√≥n</h2>
  <button onclick="testConnection()">üîå Test Conexi√≥n</button>
  <div id="conn-result"></div>
</div>

<div class="card">
  <h2>PASO 2 ‚Äî Descubrir campos de heroStats</h2>
  <button onclick="introspectHeroStats()">üîç Ver campos de heroStats</button>
  <div id="schema-result"></div>
</div>

<div class="card">
  <h2>PASO 3 ‚Äî Descubrir campos de heroes(heroId:)</h2>
  <button onclick="introspectHeroes()">üîç Ver campos de heroes</button>
  <div id="heroes-result"></div>
</div>

<div class="card">
  <h2>PASO 4 ‚Äî Probar query manual</h2>
  <textarea id="manual-query">{ heroStats { winWeek { heroId winCount matchCount } } }</textarea>
  <button onclick="runManual()">‚ñ∂ Ejecutar query</button>
  <div id="manual-result"></div>
</div>

<div class="card">
  <h2>PASO 5 ‚Äî Buscar campos con "item" o "purchase"</h2>
  <button onclick="findItemFields()">üéØ Buscar campos de items</button>
  <div id="item-fields-result"></div>
</div>

<script>
const TOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJTdWJqZWN0IjoiMzIzZmQ3NzgtNzNhNC00YWFkLWE4OTctNWU1Y2E4MTRhYzBkIiwiU3RlYW1JZCI6IjE1NzIzNzI4MyIsIkFQSVVzZXIiOiJ0cnVlIiwibmJmIjoxNzcxNTM2MzE5LCJleHAiOjE4MDMwNzIzMTksImlhdCI6MTc3MTUzNjMxOSwiaXNzIjoiaHR0cHM6Ly9hcGkuc3RyYXR6LmNvbSJ9.rrLRWszzVEOqTJ0nfVI33jeUv6Q8gs3QI4vGE_DN4VA";
const GQL = "https://api.stratz.com/graphql";

function log(elId, html) { document.getElementById(elId).innerHTML = html; }
function pre(data) { return `<pre>${JSON.stringify(data,null,2)}</pre>`; }

async function gql(query) {
  const res = await fetch(GQL, {
    method:'POST',
    headers:{'Content-Type':'application/json','Authorization':`Bearer ${TOKEN}`},
    body:JSON.stringify({query})
  });
  if(!res.ok) throw new Error(`HTTP ${res.status}: ${await res.text()}`);
  const j = await res.json();
  if(j.errors) throw new Error(j.errors.map(e=>e.message).join('\n'));
  return j;
}

async function testConnection() {
  log('conn-result','<span class="spin">‚è≥</span> Conectando...');
  try {
    const r = await gql('{ __typename }');
    log('conn-result',`<span class="ok">‚úÖ CONEXI√ìN OK</span><pre>${JSON.stringify(r,null,2)}</pre>`);
  } catch(e) {
    log('conn-result',`<span class="err">‚ùå ERROR: ${e.message}</span>`);
  }
}

async function introspectHeroStats() {
  log('schema-result','<span class="spin">‚è≥</span> Analizando schema...');
  try {
    const r = await gql(`{
      __type(name: "HeroStatType") {
        name
        fields {
          name
          description
          args { name type { name kind ofType { name kind ofType { name kind } } } }
          type { name kind ofType { name kind } }
        }
      }
    }`);
    const fields = r.data?.__type?.fields || [];
    if(fields.length === 0) {
      log('schema-result', `<span class="err">‚ùå No se encontr√≥ HeroStatType</span>${pre(r)}`);
      return;
    }
    const fieldList = fields.map(f => {
      const args = f.args?.map(a=>a.name).join(', ') || '';
      return `<strong style="color:#f59e0b">${f.name}</strong>(${args}) ‚Üí ${f.type?.name||f.type?.ofType?.name||'?'}`;
    }).join('<br/>');
    log('schema-result', `<span class="ok">‚úÖ ${fields.length} campos encontrados en HeroStatType:</span><div style="background:#0d1017;border:1px solid rgba(255,255,255,.08);border-radius:8px;padding:14px;margin-top:8px;font-size:12px;line-height:2">${fieldList}</div>`);
  } catch(e) {
    log('schema-result', `<span class="err">‚ùå ${e.message}</span>`);
  }
}

async function introspectHeroes() {
  log('heroes-result','<span class="spin">‚è≥</span> Analizando...');
  try {
    // Try to find the Hero type fields
    const r = await gql(`{
      __type(name: "HeroType") {
        name
        fields {
          name
          description
          args { name type { name kind ofType { name } } }
          type { name kind ofType { name kind } }
        }
      }
    }`);
    const fields = r.data?.__type?.fields || [];
    const fieldList = fields.map(f => {
      const args = f.args?.map(a=>a.name).join(', ') || '';
      return `<strong style="color:#60a5fa">${f.name}</strong>(${args}) ‚Üí ${f.type?.name||f.type?.ofType?.name||'?'}`;
    }).join('<br/>');
    log('heroes-result', `<span class="ok">‚úÖ ${fields.length} campos en HeroType:</span><div style="background:#0d1017;border:1px solid rgba(255,255,255,.08);border-radius:8px;padding:14px;margin-top:8px;font-size:12px;line-height:2">${fieldList}</div>`);
  } catch(e) {
    log('heroes-result', `<span class="err">‚ùå ${e.message}</span>`);
  }
}

async function runManual() {
  const q = document.getElementById('manual-query').value.trim();
  if(!q) return;
  log('manual-result','<span class="spin">‚è≥</span> Ejecutando...');
  try {
    const r = await gql(q);
    log('manual-result', `<span class="ok">‚úÖ OK</span><pre>${JSON.stringify(r,null,2).slice(0,3000)}</pre>`);
  } catch(e) {
    log('manual-result', `<span class="err">‚ùå ${e.message}</span>`);
  }
}

async function findItemFields() {
  log('item-fields-result','<span class="spin">‚è≥</span> Buscando en schema completo...');
  try {
    // Get full schema types
    const r = await gql(`{
      __schema {
        types {
          name
          fields {
            name
            args { name }
          }
        }
      }
    }`);
    const types = r.data?.__schema?.types || [];
    const results = [];
    for(const t of types) {
      if(!t.fields) continue;
      for(const f of t.fields) {
        const fn = f.name.toLowerCase();
        if(fn.includes('item') || fn.includes('purchase') || fn.includes('boot')) {
          results.push(`<strong style="color:#f59e0b">${t.name}</strong>.<strong style="color:#4ade80">${f.name}</strong>(${(f.args||[]).map(a=>a.name).join(', ')})`);
        }
      }
    }
    if(results.length === 0) {
      log('item-fields-result', `<span class="err">‚ùå No se encontraron campos de items/purchase en el schema</span>${pre(r).slice(0,500)}`);
    } else {
      log('item-fields-result', `<span class="ok">‚úÖ ${results.length} campos encontrados:</span><div style="background:#0d1017;border:1px solid rgba(255,255,255,.08);border-radius:8px;padding:14px;margin-top:8px;font-size:12px;line-height:2">${results.join('<br/>')}</div>`);
    }
  } catch(e) {
    log('item-fields-result', `<span class="err">‚ùå ${e.message}</span>`);
  }
}
</script>
</body>
</html>
